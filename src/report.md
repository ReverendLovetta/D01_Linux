# Установка и обновления системы Linux. Основы администрорования.
---
## Part 1. Уcтановка ОС
---
- Узнаем версию Ubuntu через команду: `cat /etc/issue`
- ![Вывод команды `cat/etc/issue`:](./screenshots/1.png "Вывод команды `cat/etc/issue`")
---
## Part 2. Создание польлзователя
---
- Добавим нового пользователя с помощью команды `sudo useradd -m lev` и добавим его в группу adm с помощью команды: `sudo usermod -aG adm lev`:
- ![Команда для создания пользователя `sudo useradd -m lev` и добавление его в группу adm `sudo usermod -aG adm lev`:](./screenshots/2.png "Создание нового пользователя и добавление его в группу adm")

- Проверим, что пользователь добавлен в группу adm с помощью команды `cat /etc/passwd`:
- ![Результат команды `cat /etc/passwd`:](./screenshots/3.png "Результат команды `cat /etc/passwd`")
---
## Part 3. Настройка сети ОС
---
-Зададим название машины вида user-1. Для этого изменим содержимое файла `/etc/hostname`. И проверим изменение командой: `uname -n`:
- ![Проверка изменения наздвания хоста машины:](./screenshots/4.png "Новое имя хоста машины")
- Далее установим временную зону, соответствующую своему текущему местополежению:
- Для этого воспользуемся командой: `sudo timedatectl set-timezone Europe/Moscow`
- ![Проверим установку временной зоны командой `timedatectl`:](./screenshots/5.png "Установка новой временной зоны")
- Далее с помощью команды `ip a` выведем все сетевые интерфейсы:
- ![`ip a`](./screenshots/6.png "Сетевые интерфейсы")
- Дадим объяснение для чего нужен интерфейс lo:
- lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost.
- С помощью команды `ip a` узнаем выданный при загрузки системы ip адрес для локальной машины:
- ![`ip a`:](./screenshots/7.png "ip адрес виртуальной машины")
- Дадим расшифровку DHCP:
- англ. Dynamic Host Configuration Protocol — протокол динамической настройки узла
- С помощью команды `ip r` выведем выведем внутренний ip-адрес:
- ![Результат команды `ip r`:](./screenshots/8.png "Внутренний ip-адрес шлюза")
- Зададим статические настройки ip, gw, dns:
- Для этого изменим файл `/etc/netplan/00-installer-config.yaml`:
- ![Откроем файл для изменения: `sudo vim /etc/netplan/00-installer-config.yaml` И пропишем следующие настройки:](./screenshots/9.png "Настройка сети")
- addresses - мой ip-адрес
- gateway4 - шлюз (мой маршрутизатор)
- nameservers - dns сервера ...
- После перезагрузки видим изменненные адреса:
- ![Результат команды `ip r`:](./screenshots/10.png "Измененные адреса")
- Пропингуем удаленные хосты 1.1.1.1 и ya.ru:
- Пингуем с помощью команды: `ping адрес`:
- ![Пингуем с помощью команды `ping`](./screenshots/11.png)
---
## Part 4. Обновление ОС
---
- С помощью команды `sudo apt update` обновим индексы репозиториев для пакетов:
- ![`sudo apt update`:](./screenshots/12.png "Обновляем индексы")
- С помощью команды `sudo apt dist-upgrade` обновим системные пакеты:
- ![Результат повторного ввода команды `sudo apt dist-upgreade`](./screenshots/13.png "Обновление системных пакетов")
---
## Part 5. Использование команды **sudo**
---
- С помощью команды `sudo usermod -aG sudo lev` добавим пользователя lev в группу sudo:
- ![Проверим, что пользователь lev находится в группе sudo: (Для этого используем команду `id lev`)](./screenshots/14.png)
- Поменяем hostname ОС от имени пользователя lev: 
- Для этого зайдем через пользователя lev
- Через команду `sudo hostnamectl set-hostname user-2` установим новое имя машины:
- ![Новое имя машины:](./screenshots/15.png)
---
## Part 6. Установка и настрйока службы времени
---
- Чтобы каждый раз не настраивать время, необходимо настроить службу синхронизации времени. 
- Для этого установим синхронизатор времени NTP:
- Для этого введем: `sudo apt install NTP`.
- После этого откроем файл `vim /etc/ntp.conf` и запишем в него следующее:
- ![содержимое файла ntp.conf:](./screenshots/16.png)
- Раскоментируем строки в файле `vim /etc/systemd/timesyncd.conf`:
- ![](./screenshots/17.png)
- Удалим файлы конфигурации ntp с помощью команды `sudo apt purge ntp`
- После этого выполним следующие команды для настройки ntp: `sudo timedatectl set-ntp true` и `sudo systemctl start systemd-timesyncd`
- После этого проверим, что служба ntp синхронизировалась с помощью команды `timedatectl show`:
- ![Результат команды `timedatectl show`:](./screenshots/18.png)
---
## Part 7. Установка и использование текстовых редакторов
---
- Установим текстовые редакторы: vim, nano, joe.
- С помощью редактора vim создадим файл, и запишем туда свой никнейм:
- ![С помощью команды `vim test_vim.txt` создадим файл и запишем в него свой никнейм](./screenshots/19.png)
- Чтобы закрыть файл и сохранить содержимое, выйдем из режима вставки с помощью `esc`, затем нажмем `:` и введем `wq`.
- Содержимое файла test_vim.txt:
- ![](./screenshots/20.png)
- С помощью редактора nano создадим файл, и запишем туда свой никнейм:
![С помощью команды `nano test_nano.txt` создадим файл и запишем в него свой никнейм](./screenshots/21.png)
- Чтобы закрыть файл и сохранить содержимое, нажмем `ctrl` + `o`, `enter` затем нажмем `ctrl` + `x`.
- Содержимое файла tets_nano.txt:
- ![](./screenshots/22.png)
- С помощью редактора joe создадим файл, и запишем туда свой никнейм:
![С помощью команды `joe test_joe.txt` создадим файл и запишем в него свой никнейм](./screenshots/23.png)
- Чтобы закрыть файл и сохранить содержимое, нажмем `ctrl` + `K` + `X`.
- Содержимое файла tets_joe.txt:
- ![](./screenshots/24.png)
- Теперь в эти же файлы с помощью этих же редакторов внесем изменения: вместо никнейма напишем s21 School 21, однако закроем их без сохранения изменений:
- для vim:
- ![Замена никнейма на 21 School 21:](./screenshots/25.png)
- Для того чтобы выйти из vim без сохранения изменений: выйдем из режима вставки с помощью `esc`, затем нажмем `:` и введем `q!`.
- Содержимое файла после выхода из программы:
- ![](./screenshots/26.png)
- для nano:
- ![Замена никнейма на 21 School 21:](./screenshots/27.png)
- Для того чтобы выйти из редактирования без сохранения нажмем `ctrl` + `x` и выберем пункт `no`.
- Содержимое файла test_nano.txt:
- ![](./screenshots/28.png)
- для joe:
- ![Замена никнейма на 21 School 21:](./screenshots/29.png)
- Для того, чтобый выйти из joe без сохранения нажмем: `ctrl` + `c` после чего `y` и `enter`
- Содержимое файла test_joe.txt:
- ![](./screenshots/30.png)
- Далее отредактируем файлы еще раз по предыдущему принципу, а затем продемонстрируем функции поиска и замены слов для каждого редактора:
- для vim: 
- Откроем и отредактируем файл:
- ![test_vim.txt:](./screenshots/31.png)
- Найдем строку School с помощью: выйдя из режима редактирования, нажмем `/` и напишем искомое слово `School`:
- ![поиск vim](./screenshots/32.png)
- Для замены слова используем: `:s/School/reverend` - заменит первое вхождение строки. Если необходимо заменить сразу все слова: `:s/School/reverend/g`.
- ![](./screenshots/33.png)
- для nano:
- Откроем и отредактируем файл:
- ![test_nano.txt](./screenshots/34.png)
- Для того чтобы выполнить поиск по файлу нажмем сочетание `ctrl` + `w`:
- ![](./screenshots/35.png)
- Для того чтобы выполнить поиск с заменой слова нажмем сочетание `ctrl` + `\`, введем слово которое хотим заменить, нажмем `enter`, введем слова на которое хотим заменить, нажмем `enter` после чего у нас будет выбор заменить только одно слово или все и нажимаем `y`
- ![](./screenshots/36.png)
- joe:
- Откроем файл и отредактируем его:
- ![test_joe.txt](./screenshots/37.png)
- Для того, чтобы найти слово, воспользуемся сочетанием: `ctrl` + `K` + `F`, после чего будет запрошен образец поиска, после ввода нажмите `enter`, затем ввести опцию поиска `enter`
- ![](./screenshots/38.png)
- если во время поиска вместо второго нажития `enter` ввести параметр `r` и ввести слово, после чего нажать `enter` и ввести `y`, будет произведена замен на это слово.
- ![](./screenshots/39.png)
---
## Part 8. Установка и базовая настройка сервиса **SSHD**
---
- Сперва установим утилиту Openssh. Для этого в консоле пропишем: `sudo apt install openssh-server -y`.
- Теперь добавим SHH-сервер в автозагрузку: `sudo systemctl enable ssh`:
- ![Добавление SSH-сервера в автозагрузку:](./screenshots/40.png)
- Проверим работоспособность утилиты и убедимся, что все корректно работает: `ssh localhost`
- ![Проверка работоспособности ssh-сервера:](./screenshots/41.png)
- Теперь изменим порт со стандартного значения 22 на 2022:
- Для этого сперва сделаем резервную копию файла конфигурации: `sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.factory-defaults`
- После этого откроем файл /etc/ssh/sshd_config на редактирование, раскомментируем строчку с Port 22 и изменим значение на 2022.
- ![Меняем порт на 2022](./screenshots/42.png)
- После сохранения изменений, перезапустим SSH-сервер: `sudo systemctl restart ssh`.
- Теперь, с помощью команды `ps` убедимся, что процесс sshd запущен:
- Для этого введем `ps -d`
- ![](./screenshots/43.png)
- **ps** - Команда ps выводит список текущих процессов на вашем сервере.
- **Ключи для команды ps:**
- A, -e, (a) - выбрать все процессы;
- a - выбрать все процессы, кроме фоновых;
- d, (g) - выбрать все процессы, даже фоновые, кроме процессов сессий;
- -N - выбрать все процессы кроме указанных;
- -С - выбирать процессы по имени команды;
- -G - выбрать процессы по ID группы;
- -p, (p) - выбрать процессы PID;
- --ppid - выбрать процессы по PID родительского процесса;
- -s - выбрать процессы по ID сессии;
- -t, (t) - выбрать процессы по tty;
- -u, (U) - выбрать процессы пользователя.

- Перезагрузим систему: `sudo reboot`.
- Проверим вывод команды `netstat -tan`:
- ![](./screenshots/44.png)
- **Значение столбцов:** 
- Proto: протокол, используемый сокетом.
- Recv-Q: количество байтов, не скопированных пользовательской программой, подключенной к этому сокету.
- Send-Q: количество неподтвержденных байтов удаленного хоста.
- Local Address - локальный адрес (имя локального хоста) и номер порта сокета. Если не указана опция -n, адрес сокета разрешается в соответствии с полным именем хоста (FQDN), а номер порта преобразуется в соответствующее имя службы.
- Foreign Address - удаленный адрес (имя удаленного хоста) и номер порта сокета.
- State - состояние сокета. Поскольку в протоколе RAW нет состояния, а UDP не использует информацию о состоянии, эта строка остается пустой. Обычно это одно из следующих значений: ESTABLISHED, SYN_SENT, SYN_RECV, FIN_WAIT1, FIN_WAIT2, TIME_WAIT, CLOSED, CLOSE_WAIT, LAST_ACK, LISTEN, CLOSING, UNKNOWN.

- **Опции netstat:**
- -a Показывать состояние всех сокетов;
- -o Показывать таймен
- -i Показывает состояние сетевых интерфейсов
- -n Показывать ip адрес, а не сетевое имя
- -r Показать таблицы маршрутизации. При использовании с опцией -s показывает статистику маршрутизации.
- -s Показать статистическую информацию по протоколам. При использовании с опцией -r показывает статистику маршрутизации.
- -f семейство_адресов - Ограничить показ статистики или адресов управляющих блоков только указанным семейством_адресов, в качестве которого можно указывать:inet Для семейства адресов AF_INET, или unix Для семейства адресов AF_UNIX.
- -I интерфейс - Показывать информацию о конкретном интерфейсе.
- -p  - Отобразить идентификатор/название процесса, создавшего сокет (-p, —programs display PID/Program name for sockets).
---
## Part 9. Установка и использование утилит **top**, **htop**.
---
- Воспользуемся командой `top`:
- ![Вывод команды `top`:](./screenshots/45.png)
- **uptime** = 25 минут
- **Количество авторизированных пользоватлей** - 1 user
- **Общая загрузка системы**: Средняя загрузка системы за последнюю минуту до запуска команды `top`: 0.00, за последнии 5 минут: 0.00, за последнии 15 минут: 0.00
- Общее количество процессов (total): 101.
- **Загрузка cpu**: 
- ![Загрузка cpu](./screenshots/46.png)
- us — процент времени на выполнение процессов пользователей, для которых не задан приоритет;
- sy — процент времени, на выполнение процессов ядра, использование CPU системой;
- ni — процент времени на выполнение процессов с заданных приоритетом;
- id — «простаивающая» вычислительная мощность;
- wa — процент времени на выполнение операций IO (ввода/вывода), то есть дисковых операций. Чем медленнее диск, тем выше будет значение для каждого процесса;
- hi — процент времени на обработку аппаратных прерываний (на уровне железа);
- si — процент времени на обработку программных прерываний (на уровне программном);
- st — мера загруженности гипервизора;
- **Загрузка памяти:**
- ![Загрузка памяти](./screenshots/47.png)
- total — общий объем оперативной памяти;
- used — объем используемой памяти;
- free — объем свободной памяти;
- buffers — объем буфера;
- cached — объем кэша операций ввода/вывода.
- **pid процесса, занимающего больше всего памяти**:
- для этого необходимо нажать сочетание `shift` + `m`:
- ![](./screenshots/48.png)
- **pid процесса, занимающего больше всего процессорного времени**:
- для этого необходимо нажать сочетание `shift` + `p`:
- ![](./screenshots/49.png)
- Воспользуемся командой **htop**:
- Отсортированные процессы по PID:
- ![](./screenshots/50.png)
- Отсортированные процессы по PERCENT_CPU:
- ![](./screenshots/51.png)
- Отсортированные процессы по PERCENT_MEM:
- ![](./screenshots/52.png)
- Отсортированные процессы по TIME:
- ![](./screenshots/53.png)
- Отфильтрованный для процесса sshd:
- ![](./screenshots/54.png)
- с процессом syslog, найденным, используя поиск:
- ![](./screenshots/55.png)
- С добавленным выводом hostname, clock и uptime:
- ![](./screenshots/56.png)
---
## Part 10. Использование утилиты **fdisk**
---
- Запустим команду `fdisk -l`:
- ![](./screenshots/57.png)
- Название жесткого диска: */dev/sda*, модель: VBOXHARDDISK
- Размер жесткого диска: 10 GiB
- Количество секторов: 20971520
- Размер swap: 907 MB
---
## Part 11. Использование утилиты **df**
---
- **Введем команду `df`**:
- ![](./screenshots/58.png)
- **Данные для корневого раздела:** 
- Размер раздела: 8.9 G
- Размер занятого пространства: 4.4 G
- Размер свободного пространства: 4.1 G
- Процент использования: 52%
- Единица измерения в выводе: GiB
- **Введем команду `df -Th`**:
- ![](./screenshots/59.png)
- **Данные для корневого раздела:** 
- Размер раздела: 8.9 G
- Размер занятого пространства: 4.4 G
- Размер свободного пространства: 4.1 G
- Процент использования: 52%
- Тип файловой системы: ext4
---
## Part 12. Использование утилиты **du**
---
- Размер папки **/home** в байтах, человекочитаемом виде:
- ![/home](./screenshots/60.png)
- Размер папаки **/var** в байтах, человекочитаемом виде:
- ![/var](./screenshots/61.png)
- Размер папаки **/var/log** в байтах, человекочитаемом виде:
- ![/var/log](./screenshots/62.png)
- Размер всего содержимого в **var/log**, с помощью команды `sudo du -a -h /var/log`:
- ![](./screenshots/63.png)
- ![](./screenshots/64.png)
---
## Part 13. Установка и использование утилиты **ncdu**
---
- `ncdu /home`:
- ![](./screenshots/65.png)
- `ncdu /var`:
- ![](./screenshots/66.png)
- `ncdu /var/log`:
- ![](./screenshots/67.png)
---
## Part 14. Работа с системными журналами
---
- Данные о последней авторизации:
- ![](./screenshots/68.png)
- ![](./screenshots/69.png)
- Данные о рестарте SSHd:
- ![](./screenshots/70.png)
---
## Part 15. Использование планировщика заданий **CRON**
---
- Список текущих заданий для CRON:
- ![](./screenshots/71.png)
- Информация из системного журнала о выполнении:
- ![](./screenshots/72.png)
- Пустой список заданий для CRON:
- ![](./screenshots/73.png)